// Minimal behavior: header shrink, reveal on scroll, scroll-spy, smooth anchor scroll
(function() {
  'use strict';
  document.addEventListener('DOMContentLoaded', () => {
    // Year
    const yearEl = document.getElementById('year');
    if (yearEl) yearEl.textContent = new Date().getFullYear();

    // Header shrink
    const header = document.getElementById('header');
    const SHRINK = 64;
    function onScroll() {
      if (window.scrollY > SHRINK) header.classList.add('shrink');
      else header.classList.remove('shrink');
    }
    onScroll();
    window.addEventListener('scroll', onScroll, { passive: true });

    // Reveal
    const revealEls = document.querySelectorAll('.reveal');
    if ('IntersectionObserver' in window) {
      const io = new IntersectionObserver((entries, obs) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            obs.unobserve(entry.target);
          }
        });
      }, { threshold: 0.12 });
      revealEls.forEach(el => io.observe(el));
    } else {
      revealEls.forEach(el => el.classList.add('visible'));
    }

    // Scroll spy
    const links = document.querySelectorAll('.nav .nav-link');
    const sections = document.querySelectorAll('main section[id]');
    if (sections.length && 'IntersectionObserver' in window) {
      const spy = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const id = entry.target.id;
            links.forEach(a => a.classList.toggle('active', a.getAttribute('href') === '#' + id));
          }
        });
      }, { rootMargin: '-35% 0px -50% 0px', threshold: 0.2 });
      sections.forEach(s => spy.observe(s));
    }

    // Smooth anchors
    document.querySelectorAll('a[href^="#"]').forEach(a => {
      a.addEventListener('click', (e) => {
        const target = document.querySelector(a.getAttribute('href'));
        if (target) {
          e.preventDefault();
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });
  });
})();